<?xml version="1.0" encoding="UTF-8"?>
<database name="painprayer" defaultIdMethod="native">

    <table name="terms" phpName="Term">
        <column name="content" type="varchar" size="100" primaryKey="true" required="true"/>
    </table>

    <table name="examTopics" phpName="Topic">
        <column name="content" type="varchar" size="100" primaryKey="true" required="true"/>
    </table>

    <table name="years" phpName="Year">
        <column name="content" type="integer" size="4" primaryKey="true" required="true"/>
    </table>

    <table name="commentTypes" phpName="CommentType">
        <column name="type" type="varchar" size="100" required="true" primaryKey="true" />
    </table>

    <table name="exams" phpName="Exam">
        <column name="id" type="integer" required="true" primaryKey="true" autoIncrement="true"/>
        <column name="examTerm" type="varchar" size="100" required="true"/>
        <column name="examTopic" type="varchar" size="100" required="true"/>
        <column name="examYear" type="integer" size="4" required="true"/>
        <column name="locked" type="integer" size="1" required="true"/>
        <column name="released" type="integer" size="1" required="true"/>
        <foreign-key foreignTable="terms">
            <reference local="examTerm" foreign="content"/>
        </foreign-key>
        <foreign-key foreignTable="examTopics">
            <reference local="examTopic" foreign="content"/>
        </foreign-key>
        <foreign-key foreignTable="years">
            <reference local="examYear" foreign="content"/>
        </foreign-key>
    </table>


    <table name="questions" phpName="Question">
        <column name="id" type="integer" required="true" primaryKey="true" autoIncrement="true"/>
        <column name="questionText" type="longvarchar" required="true" />
        <column name="questionName" type="varchar" size="100" />
    </table>

    <table name="comments" phpName="Comment">
        <column name="id" type="integer" required="true" primaryKey="true" autoIncrement="true"/>
        <column name="commentText" type="longvarchar" required="true" />
    </table>

    <table name="elements" phpName="Element">
        <column name="id" type="integer" required="true" primaryKey="true" autoIncrement="true"/>
        <column name="elementName" type="varchar" size="100" />
        <column name="displayText" type="varchar" size="225" required="true" />
        <column name="commentText" type="longvarchar" />
        <!--<column name="commentID" type="integer" />-->
        <!--<foreign-key foreignTable="comments">-->
        <!--<reference local="commentID" foreign="id"/>-->
        <!--</foreign-key>-->
    </table>

    <table name="students" phpName="Student">
        <column name="id" type="integer" required="true" primaryKey="true" autoIncrement="true"/>
        <column name="sid" type="integer" required="true" />
        <column name="studentName" type="varchar" size="200" />
        <column name="email" type="varchar" size="225" />
    </table>

    <table name="classes" phpName="Kumi">
        <column name="id" type="integer" required="true" primaryKey="true" autoIncrement="true"/>
        <column name="year" type="integer" size="4" />
        <column name="nickname" type="varchar" size="100" />
    </table>

    <table name="stockTexts" phpName="StockText">
        <column name="id" type="integer" required="true" primaryKey="true" autoIncrement="true"/>
        <column name="valence" type="varchar" />
        <column name="commentText" type="longvarchar" required="true" />
    </table>

    <!--Junction tables below-->
    <!--Score tables-->
    <table name="questionScores" phpName="QuestionScore" >
        <column name="examID" type="integer" required="true" primaryKey="true"/>
        <column name="questionID" type="integer" required="true" primaryKey="true" />
        <column name="studentID" type="integer" required="true" primaryKey="true" />
        <column name="questionScore" type="float" />
        <behavior name="timestampable" />
        <foreign-key foreignTable="exams">
            <reference local="examID" foreign="id"/>
        </foreign-key>
        <foreign-key foreignTable="students">
            <reference local="studentID" foreign="id"/>
        </foreign-key>
        <foreign-key foreignTable="questions">
            <reference local="questionID" foreign="id"/>
        </foreign-key>
    </table>

    <table name="elementScores" phpName="ElementScore" >
        <column name="examID" type="integer" required="true" primaryKey="true" />
        <column name="elementID" type="integer" required="true" primaryKey="true" />
        <column name="studentID" type="integer" required="true" primaryKey="true" />
        <column name="elementScore" type="float" />
        <behavior name="timestampable" />
        <foreign-key foreignTable="exams">
            <reference local="examID" foreign="id"/>
        </foreign-key>
        <foreign-key foreignTable="elements">
            <reference local="elementID" foreign="id"/>
        </foreign-key>
        <foreign-key foreignTable="students">
            <reference local="studentID" foreign="id"/>
        </foreign-key>
    </table>

    <table name="examInfo" phpName="ExamInfo" >
        <column name="examID" type="integer" required="true" primaryKey="true"/>
        <column name="studentID" type="integer" required="true" primaryKey="true"/>
        <column name="completionOrder" type="integer" />
        <column name="pages" type="float" />
        <column name="notecard" type="float" />
        <column name="examGroupNumber" type="integer" />
        <behavior name="timestampable" />
        <foreign-key foreignTable="exams">
            <reference local="examID" foreign="id"/>
        </foreign-key>
        <foreign-key foreignTable="students">
            <reference local="studentID" foreign="id"/>
        </foreign-key>
    </table>

    <!--Exam constituents-->
    <table name="questionAssigner" phpName="QuestionAssigner">
        <column name="examID" type="integer" required="true" primaryKey="true"/>
        <column name="questionNumber" type="integer" size="2" required="true" primaryKey="true"  />
        <column name="questionID" type="integer" required="true" />
        <behavior name="timestampable" />
        <foreign-key foreignTable="exams">
            <reference local="examID" foreign="id"/>
        </foreign-key>
        <foreign-key foreignTable="questions">
            <reference local="questionID" foreign="id" />
        </foreign-key>
    </table>

    <table name="elementXquestions" phpName="ElementAssignment">
        <column name="examID" type="integer" primaryKey="true" required="true" />
        <column name="questionID" type="integer" primaryKey="true" required="true" />
        <column name="subtask" type="integer" primaryKey="true" size="2" required="true" />
        <column name="elementID" type="integer" required="true" />
        <behavior name="timestampable" />
        <foreign-key foreignTable="exams">
            <reference local="examID" foreign="id"/>
        </foreign-key>
        <foreign-key foreignTable="questions">
            <reference local="questionID" foreign="id" />
        </foreign-key>
        <foreign-key foreignTable="elements">
            <reference local="elementID" foreign="id"/>
        </foreign-key>
    </table>

    <!--Class associations-->
    <table name="studentsXclasses" phpName="StudentClassAssignment" isCrossRef="true">
        <column name="studentID" type="integer" primaryKey="true" required="true" />
        <column name="classID" type="integer" primaryKey="true" required="true" />
        <foreign-key foreignTable="students">
            <reference local="studentID" foreign="id"/>
        </foreign-key>
        <foreign-key foreignTable="classes">
            <reference local="classID" foreign="id" />
        </foreign-key>
    </table>

    <table name="examsXclasses" phpName="ExamClassAssignment">
        <column name="classID" type="integer" primaryKey="true" required="true" />
        <column name="examID" type="integer" primaryKey="true" required="true" />
        <foreign-key foreignTable="exams">
            <reference local="examID" foreign="id"/>
        </foreign-key>
        <foreign-key foreignTable="classes">
            <reference local="classID" foreign="id" />
        </foreign-key>
    </table>
    <!--Timers-->
    <table name="time_grading" phpName="GradingTime">
        <column name="id" type="integer" required="true" primaryKey="true" autoIncrement="true"/>
        <column name="examID" type="integer" required="true" />
        <column name="studentID" type="integer" required="true" />
        <column name="seconds" type="float" />
        <behavior name="timestampable" />
        <unique>
            <unique-column name="examID" />
            <unique-column name="studentID" />
        </unique>
        <foreign-key foreignTable="exams">
            <reference local="examID" foreign="id"/>
        </foreign-key>
        <foreign-key foreignTable="students">
            <reference local="studentID" foreign="id" />
        </foreign-key>
    </table>

    <table name="time_group" phpName="GroupTime">
        <column name="examID" type="integer" required="true" primaryKey="true"/>
        <column name="groupID" type="integer" required="true" primaryKey="true"/>
        <column name="seconds" type="float" />
        <behavior name="timestampable" />
        <foreign-key foreignTable="exams">
            <reference local="examID" foreign="id"/>
        </foreign-key>
    </table>

    <!--Comments-->
    <table name="commentAssigner" phpName="CommentAssignment">
        <column name="id" type="integer" required="true" primaryKey="true" autoIncrement="true"/>
        <column name="examID" type="integer" required="true" />
        <column name="elementID" type="integer" required="true" />
        <column name="commentID" type="integer" required="true" />
        <column name="commentType" type="varchar" size="100" required="true" />
        <column name="minScore" type="float"  />
        <column name="maxScore" type="float" />
        <unique>
            <unique-column name="examID" />
            <unique-column name="elementID" />
            <unique-column name="commentType" />
        </unique>
        <foreign-key foreignTable="exams">
            <reference local="examID" foreign="id"/>
        </foreign-key>
        <foreign-key foreignTable="elements">
            <reference local="elementID" foreign="id"/>
        </foreign-key>
        <foreign-key foreignTable="comments">
            <reference local="commentID" foreign="id"/>
        </foreign-key>
        <foreign-key foreignTable="commentTypes">
            <reference local="commentType" foreign="type"/>
        </foreign-key>
    </table>

    <table name="comments_missing" phpName="CommentMissing">
        <column name="examID" type="integer" required="true" primaryKey="true"/>
        <column name="elementID" type="integer" required="true" primaryKey="true"/>
        <column name="commentID" type="integer" required="true" />
        <column name="stockCommentID" type="integer"  />
        <column name="minScore" type="float"  />
        <column name="maxScore" type="float" />
        <foreign-key foreignTable="exams">
            <reference local="examID" foreign="id"/>
        </foreign-key>
        <foreign-key foreignTable="elements">
            <reference local="elementID" foreign="id"/>
        </foreign-key>
        <foreign-key foreignTable="comments">
            <reference local="commentID" foreign="id"/>
        </foreign-key>
        <foreign-key foreignTable="stockTexts">
            <reference local="stockCommentID" foreign="id"/>
        </foreign-key>
    </table>

    <table name="comments_poor" phpName="CommentPoor">
        <column name="examID" type="integer" required="true" primaryKey="true"/>
        <column name="elementID" type="integer" required="true" primaryKey="true"/>
        <column name="commentID" type="integer" required="true" />
        <column name="stockCommentID" type="integer"  />
        <column name="minScore" type="float"  />
        <column name="maxScore" type="float" />
        <foreign-key foreignTable="exams">
            <reference local="examID" foreign="id"/>
        </foreign-key>
        <foreign-key foreignTable="elements">
            <reference local="elementID" foreign="id"/>
        </foreign-key>
        <foreign-key foreignTable="comments">
            <reference local="commentID" foreign="id"/>
        </foreign-key>
        <foreign-key foreignTable="stockTexts">
            <reference local="stockCommentID" foreign="id"/>
        </foreign-key>
    </table>


    <table name="comments_competent" phpName="CommentCompetent">
        <column name="examID" type="integer" required="true" primaryKey="true"/>
        <column name="elementID" type="integer" required="true" primaryKey="true"/>
        <column name="commentID" type="integer" required="true" />
        <column name="stockCommentID" type="integer"  />
        <column name="minScore" type="float"  />
        <column name="maxScore" type="float" />
        <foreign-key foreignTable="exams">
            <reference local="examID" foreign="id"/>
        </foreign-key>
        <foreign-key foreignTable="elements">
            <reference local="elementID" foreign="id"/>
        </foreign-key>
        <foreign-key foreignTable="comments">
            <reference local="commentID" foreign="id"/>
        </foreign-key>
        <foreign-key foreignTable="stockTexts">
            <reference local="stockCommentID" foreign="id"/>
        </foreign-key>
    </table>

    <table name="comments_excellent" phpName="CommentExcellent">
        <column name="examID" type="integer" required="true" primaryKey="true"/>
        <column name="elementID" type="integer" required="true" primaryKey="true"/>
        <column name="commentID" type="integer" required="true" />
        <column name="stockCommentID" type="integer"  />
        <column name="minScore" type="float"  />
        <column name="maxScore" type="float" />
        <foreign-key foreignTable="exams">
            <reference local="examID" foreign="id"/>
        </foreign-key>
        <foreign-key foreignTable="elements">
            <reference local="elementID" foreign="id"/>
        </foreign-key>
        <foreign-key foreignTable="comments">
            <reference local="commentID" foreign="id"/>
        </foreign-key>
        <foreign-key foreignTable="stockTexts">
            <reference local="stockCommentID" foreign="id"/>
        </foreign-key>
    </table>

    <!--Preferences-->
    <table name="preferences" phpName="Preferences">
        <column name="jqueryTheme" type="varchar" size="100" />
        <column name="autostartExam" type="boolean" />
        <column name="autostartGroup" type="boolean"/>
        <column name="dashboard_num_exams" type="integer" />
        <column name="number_questions" type="integer" />
        <column name="number_subtasks" type="integer" />
    </table>

</database>
